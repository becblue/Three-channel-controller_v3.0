# 三通道高压切换箱控制系统 - 用户使用手册

**版本**: v3.0  
**MCU**: STM32F103RCT6  
**编制日期**: 2025年1月  
**适用范围**: 三通道高压切换箱控制系统

---

## ? 目录

1. [系统概述](#1-系统概述)
2. [安全须知](#2-安全须知)
3. [硬件连接](#3-硬件连接)
4. [系统启动](#4-系统启动)
5. [操作指南](#5-操作指南)
6. [显示界面](#6-显示界面)
7. [异常处理](#7-异常处理)
8. [维护保养](#8-维护保养)
9. [故障排除](#9-故障排除)
10. [技术参数](#10-技术参数)

---

## 1. 系统概述

### 1.1 产品简介

三通道高压切换箱控制系统是一款专业的工业级高压开关控制设备，采用STM32F103RCT6微控制器，具备完整的安全监控、状态反馈、温度保护和人机交互功能。

### 1.2 核心特性

- **三通道互锁控制**: 确保同时只能有一个通道开启
- **双路冗余设计**: 每通道配备两路继电器，提高可靠性
- **15种异常监控**: 涵盖使能冲突、状态反馈、温度、电源等异常
- **实时温度监控**: 三路NTC传感器联动风扇控制
- **OLED状态显示**: 实时显示系统状态和异常信息
- **分级报警机制**: 声光报警，异常分级处理

### 1.3 系统组成

| 组件 | 数量 | 功能描述 |
|------|------|----------|
| 主控制器 | 1 | STM32F103RCT6，系统核心控制 |
| 继电器模块 | 6 | 双路冗余继电器控制 |
| 接触器反馈 | 3 | 通道状态反馈检测 |
| NTC传感器 | 3 | 温度监控 |
| OLED显示屏 | 1 | 状态显示（128×64像素） |
| 报警模块 | 1 | 蜂鸣器+ALARM输出 |

---

## 2. 安全须知

### ?? 重要安全警告

1. **高压危险**: 本设备用于高压环境，操作前请确保断电并锁定
2. **专业操作**: 只允许具备电气资质的专业人员操作
3. **接地要求**: 设备必须可靠接地，接地电阻<4Ω
4. **环境要求**: 避免在潮湿、易燃、腐蚀性环境中使用

### ? 操作安全规范

- **上电前检查**: 确认所有连接正确，无短路现象
- **断电操作**: 维护时必须断开所有电源
- **温度监控**: 注意设备温度，异常时立即停机检查
- **定期检查**: 每月检查连接线缆和接触器状态

---

## 3. 硬件连接

### 3.1 电源连接

| 电源类型 | 电压等级 | 连接说明 |
|----------|----------|----------|
| 控制电源 | DC 24V | 系统主电源，用于继电器驱动 |
| 逻辑电源 | DC 3.3V | MCU供电（内部转换） |
| 高压电源 | 用户定义 | 通过接触器切换的主回路电源 |

### 3.2 控制信号连接

#### 3.2.1 使能信号输入
```
K1_EN (PB9)  ← 通道1使能信号（低电平有效）
K2_EN (PB8)  ← 通道2使能信号（低电平有效） 
K3_EN (PA15) ← 通道3使能信号（低电平有效）
```

#### 3.2.2 状态反馈信号
```
继电器状态反馈：
K1_1_STA (PC4) ← 继电器1-1状态（高电平=闭合）
K1_2_STA (PB1) ← 继电器1-2状态（高电平=闭合）
K2_1_STA (PC5) ← 继电器2-1状态（高电平=闭合）
K2_2_STA (PB10)← 继电器2-2状态（高电平=闭合）
K3_1_STA (PB0) ← 继电器3-1状态（高电平=闭合）
K3_2_STA (PB11)← 继电器3-2状态（高电平=闭合）

接触器状态反馈：
SW1_STA (PA8) ← 接触器1状态（高电平=闭合）
SW2_STA (PC9) ← 接触器2状态（高电平=闭合）
SW3_STA (PC8) ← 接触器3状态（高电平=闭合）
```

### 3.3 输出信号连接

#### 3.3.1 继电器控制输出
```
通道1继电器控制：
K1_1_ON (PC0), K1_1_OFF (PC1)
K1_2_ON (PB12), K1_2_OFF (PA3)

通道2继电器控制：
K2_1_ON (PC2), K2_1_OFF (PC3)
K2_2_ON (PA4), K2_2_OFF (PA5)

通道3继电器控制：
K3_1_ON (PC7), K3_1_OFF (PC6)
K3_2_ON (PD2), K3_2_OFF (PA7)
```

#### 3.3.2 报警输出
```
ALARM (PB4) → 异常报警输出（低电平有效）
BEEP (PB3)  → 蜂鸣器控制（低电平有效）
```

### 3.4 传感器连接

```
温度传感器：
NTC_1 (PA0) ← ADC通道0，温度传感器1
NTC_2 (PA1) ← ADC通道1，温度传感器2  
NTC_3 (PA2) ← ADC通道2，温度传感器3

风扇控制：
FAN_PWM (PA6) → PWM输出，风扇速度控制
FAN_SEN (PC12) ← 风扇转速反馈

电源监控：
DC_CTRL (PB5) ← 电源监控信号（高电平=异常）
```

### 3.5 通信接口

```
调试串口：
USART3_TX (PC10) → 调试信息输出
USART3_RX (PC11) ← 调试命令输入

OLED显示：
I2C1_SDA (PB7) ? OLED数据线
I2C1_SCL (PB6) ? OLED时钟线
```

---

## 4. 系统启动

### 4.1 启动流程

系统上电后自动执行以下启动序列：

```
步骤1: LOGO显示（2秒）
┌─────────────────────┐
│    公司LOGO显示     │
│    系统初始化       │
└─────────────────────┘
           ↓
步骤2: 系统自检（3秒）
┌─────────────────────┐
│  Expected State     │
│     │
│      ?   │
│     │
└─────────────────────┘
           ↓
步骤3: 正常运行
┌─────────────────────┐
│ System Normal       │
│ Channel_1: OFF      │
│ Channel_2: OFF      │
│ Channel_3: OFF      │
│ T1:25.3C T2:26.1C   │
│ T3:25.8C Fan:1200RPM│
└─────────────────────┘
```

### 4.2 自检内容

系统自检包含四个步骤，每步25%进度：

| 步骤 | 英文显示 | 检测内容 | 通过条件 |
|------|----------|----------|----------|
| 1 | Expected State | 期望状态识别 | 识别当前系统应处状态 |
| 2 | Relay Correct | 继电器纠错 | 继电器状态与期望一致 |
| 3 | Contact Check | 接触器检查 | 接触器状态正确 |
| 4 | Temp Safety | 温度安全检测 | 所有温度<60℃ |

### 4.3 自检结果处理

- **自检通过**: 进入正常运行状态，显示主界面
- **自检失败**: 产生N类异常，显示异常信息，启动报警

---

## 5. 操作指南

### 5.1 通道操作

#### 5.1.1 开启通道

**操作步骤**：
1. 确认其他通道已关闭（互锁保护）
2. 将对应K_EN信号拉低（0V）
3. 系统自动检测并执行开启序列
4. 观察OLED显示确认通道状态

**开启时序**：
```
K_EN信号下降沿 → 50ms间隔检测3次 → 互锁检查 → 
继电器脉冲输出(500ms) → 延时500ms → 状态确认 → 
显示更新
```

**成功标志**：
- OLED显示"Channel_X: ON"
- 对应STA信号全部为高电平
- 无异常报警

#### 5.1.2 关闭通道

**操作步骤**：
1. 将对应K_EN信号拉高（24V）
2. 系统自动检测并执行关闭序列
3. 观察OLED显示确认通道状态

**关闭时序**：
```
K_EN信号上升沿 → 50ms间隔检测3次 → 
继电器脉冲输出(500ms) → 延时500ms → 状态确认 → 
显示更新
```

**成功标志**：
- OLED显示"Channel_X: OFF"
- 对应STA信号全部为低电平
- 无异常报警

### 5.2 状态监控

#### 5.2.1 实时状态查看

通过OLED显示屏可实时查看：
- **异常信息**：顶部区域显示当前异常
- **通道状态**：中部区域显示三通道开关状态
- **温度风扇**：底部区域显示温度和风扇转速

#### 5.2.2 串口调试信息

连接串口（115200波特率）可获得详细调试信息：
```
[系统控制] 系统进入正常运行状态
[继电器控制] Channel_1开启成功
[温度监控] NTC1: 25.3°C, 风扇PWM: 50%
[安全监控] 系统正常，无异常标志
```

### 5.3 温度管理

#### 5.3.1 温度阈值

| 温度范围 | 风扇状态 | 系统响应 |
|----------|----------|----------|
| <35℃ | 50% PWM | 正常运行 |
| 35℃~59℃ | 95% PWM | 高温运行 |
| ≥60℃ | 95% PWM | 温度异常报警 |

#### 5.3.2 温度保护

- **回差保护**：温度下降2℃后状态才改变
- **异常报警**：≥60℃时产生K/L/M类异常
- **持续监控**：每100ms检测一次温度

---

## 6. 显示界面

### 6.1 OLED显示布局

OLED屏幕（128×64像素）分为三个区域：

```
┌─────────────────────────────────┐ ← 异常信息区
│ A:Multi EN Active               │   (第0行，6×8字体)
├─────────────────────────────────┤
│                                 │
│        Channel_1: OFF           │ ← 通道状态区  
│        Channel_2: OFF           │   (第2-4行，6×8字体)
│        Channel_3: OFF           │   (居中显示)
│                                 │
├─────────────────────────────────┤
│ T1:25.3C T2:26.1C T3:25.8C      │ ← 温度风扇区
│ Fan: 1200RPM                    │   (第6-7行，6×8字体)
└─────────────────────────────────┘
```

### 6.2 显示内容说明

#### 6.2.1 异常信息显示

| 异常类型 | 显示格式 | 说明 |
|----------|----------|------|
| A类异常 | `A:Multi EN Active` | 多路使能冲突 |
| B类异常 | `B:K1_1_STA Error` | 继电器1-1异常 |
| K类异常 | `K:NTC1 61.2C` | NTC1温度异常 |
| O类异常 | `O:DC24V Loss` | 电源异常 |

#### 6.2.2 通道状态显示

| 状态 | 显示格式 | 说明 |
|------|----------|------|
| 关闭 | `Channel_1: OFF` | 通道关闭状态 |
| 开启 | `Channel_1: ON` | 通道开启状态 |
| 异常 | `Channel_1: ERROR` | 通道异常状态 |

#### 6.2.3 温度风扇显示

```
T1:25.3C T2:26.1C T3:25.8C    ← 三路温度显示
Fan: 1200RPM                   ← 风扇转速显示
```

### 6.3 自检界面

自检过程中显示进度条和步骤描述：

```
     Expected State        ← 当前步骤描述
                           ← 4行像素间隔
           ← 进度条边框
                    ?
            ?     ← 进度填充（25%示例）
                    ?
    
```

---

## 7. 异常处理

### 7.1 异常分类

系统支持15种异常类型（A~O类）：

#### 7.1.1 控制异常（A类）
- **A类**：使能冲突异常
- **触发条件**：多个K_EN信号同时为低电平
- **报警方式**：1秒间隔脉冲
- **解除条件**：只有一路或全部为高电平

#### 7.1.2 继电器异常（B~G类）
- **B类**：K1_1_STA工作异常
- **C类**：K2_1_STA工作异常  
- **D类**：K3_1_STA工作异常
- **E类**：K1_2_STA工作异常
- **F类**：K2_2_STA工作异常
- **G类**：K3_2_STA工作异常
- **报警方式**：50ms间隔脉冲
- **解除条件**：状态符合真值表

#### 7.1.3 接触器异常（H~J类）
- **H类**：SW1_STA工作异常
- **I类**：SW2_STA工作异常
- **J类**：SW3_STA工作异常  
- **报警方式**：50ms间隔脉冲
- **解除条件**：状态符合真值表

#### 7.1.4 温度异常（K~M类）
- **K类**：NTC_1温度异常（≥60℃）
- **L类**：NTC_2温度异常（≥60℃）
- **M类**：NTC_3温度异常（≥60℃）
- **报警方式**：持续低电平
- **解除条件**：温度降至58℃以下

#### 7.1.5 系统异常（N~O类）
- **N类**：自检异常
- **O类**：DC24V电源异常
- **报警方式**：1秒间隔脉冲
- **解除条件**：自检通过/电源恢复

### 7.2 报警机制

#### 7.2.1 ALARM输出
- **输出方式**：任何异常时立即输出低电平
- **恢复条件**：所有异常解除后输出高电平
- **响应时间**：<500ms

#### 7.2.2 蜂鸣器报警

| 异常优先级 | 异常类型 | 蜂鸣器模式 |
|------------|----------|------------|
| 最高 | K~M类（温度） | 持续低电平 |
| 中等 | B~J类（状态） | 50ms间隔脉冲 |
| 一般 | A,N,O类（其他） | 1秒间隔脉冲 |

### 7.3 异常处理步骤

#### 7.3.1 发现异常
1. **观察报警**：听到蜂鸣器或看到ALARM指示
2. **查看显示**：OLED顶部显示异常信息
3. **记录信息**：记录异常类型和时间

#### 7.3.2 分析原因
1. **查表对照**：根据异常代码查找原因
2. **检查硬件**：检查相关连接和设备状态
3. **查看日志**：通过串口查看详细信息

#### 7.3.3 处理异常
1. **安全断电**：严重异常时立即断电
2. **排除故障**：根据异常类型排除故障
3. **确认恢复**：异常解除后确认系统正常

### 7.4 常见异常处理

#### 7.4.1 A类异常（使能冲突）
**现象**：多个通道同时使能
**处理**：
1. 检查控制信号线是否短路
2. 确保只有一个通道使能信号为低电平
3. 系统自动解除异常

#### 7.4.2 B~J类异常（状态反馈）
**现象**：继电器或接触器状态异常
**处理**：
1. 检查继电器/接触器是否正常工作
2. 检查状态反馈信号线连接
3. 必要时更换故障器件

#### 7.4.3 K~M类异常（温度）
**现象**：设备过热
**处理**：
1. 立即停机检查散热系统
2. 清理散热器和风扇
3. 检查环境温度是否过高
4. 等待温度降低后重新启动

#### 7.4.4 O类异常（电源）
**现象**：DC24V电源异常
**处理**：
1. 检查电源供应是否正常
2. 检查电源线连接
3. 电源恢复后系统自动解除异常

---

## 8. 维护保养

### 8.1 日常维护

#### 8.1.1 每日检查
- [ ] 观察OLED显示是否正常
- [ ] 检查是否有异常报警
- [ ] 记录系统运行状态

#### 8.1.2 每周检查  
- [ ] 检查所有连接线缆
- [ ] 清理设备表面灰尘
- [ ] 检查风扇运行状态
- [ ] 测试报警功能

#### 8.1.3 每月检查
- [ ] 检查继电器动作是否正常
- [ ] 检查接触器状态反馈
- [ ] 校验温度传感器读数
- [ ] 备份系统配置

### 8.2 预防性维护

#### 8.2.1 清洁保养
- **频率**：每月一次
- **内容**：清理散热器、风扇、连接端子
- **工具**：软毛刷、压缩空气、无水酒精

#### 8.2.2 紧固检查
- **频率**：每季度一次  
- **内容**：检查所有螺丝连接、端子紧固
- **工具**：扭力扳手、万用表

#### 8.2.3 功能测试
- **频率**：每半年一次
- **内容**：全功能测试、异常模拟测试
- **记录**：测试结果和维护记录

### 8.3 备件管理

#### 8.3.1 推荐备件

| 备件名称 | 型号规格 | 建议库存 | 更换周期 |
|----------|----------|----------|----------|
| 继电器 | 按原型号 | 6个 | 2年 |
| NTC传感器 | 10KΩ B3435 | 3个 | 3年 |
| 风扇 | 按原规格 | 1个 | 1年 |
| 保险丝 | 按原规格 | 10个 | 按需 |

#### 8.3.2 备件存储
- **环境要求**：干燥、常温、避光
- **包装要求**：防静电包装
- **标识要求**：型号、日期、数量

---

## 9. 故障排除

### 9.1 系统无法启动

#### 9.1.1 现象描述
- OLED无显示
- 无任何指示灯
- 串口无输出

#### 9.1.2 排查步骤
1. **检查电源**
   - 确认DC24V电源正常
   - 检查电源线连接
   - 测量MCU供电电压（应为3.3V）

2. **检查硬件**
   - 检查MCU是否正常
   - 检查晶振电路
   - 检查复位电路

3. **检查程序**
   - 确认程序已正确下载
   - 检查程序完整性

### 9.2 自检失败

#### 9.2.1 现象描述
- 自检过程中断
- 显示N类异常
- 蜂鸣器1秒间隔报警

#### 9.2.2 排查步骤
1. **查看串口信息**
   ```
   [自检] 第1步：期望状态识别 - 失败
   [自检] 检测到K1_EN信号异常
   ```

2. **按步骤排查**
   - **步骤1失败**：检查K_EN信号状态
   - **步骤2失败**：检查继电器工作状态  
   - **步骤3失败**：检查接触器状态反馈
   - **步骤4失败**：检查温度传感器

### 9.3 通道无法开启

#### 9.3.1 现象描述
- K_EN信号正常
- 继电器无动作
- 显示相关异常

#### 9.3.2 排查步骤
1. **检查使能信号**
   - 确认K_EN信号到达并稳定
   - 检查信号幅度（应为0V-24V）

2. **检查互锁条件**
   - 确认其他通道已关闭
   - 检查其他通道状态反馈

3. **检查继电器**
   - 测量继电器控制信号
   - 检查继电器线圈阻值
   - 确认继电器机械动作

### 9.4 温度异常

#### 9.4.1 现象描述
- 显示K/L/M类异常
- 蜂鸣器持续鸣叫
- 风扇全速运行

#### 9.4.2 排查步骤
1. **确认实际温度**
   - 用红外测温仪测量实际温度
   - 对比OLED显示温度

2. **检查传感器**
   - 测量NTC电阻值
   - 检查传感器连接
   - 对比RT值表确认准确性

3. **检查散热系统**
   - 确认风扇正常运行
   - 清理散热器
   - 检查散热路径

### 9.5 显示异常

#### 9.5.1 现象描述
- OLED显示内容错误
- 显示闪烁或花屏
- 部分内容缺失

#### 9.5.2 排查步骤
1. **检查I2C通信**
   - 测量I2C信号波形
   - 检查上拉电阻
   - 确认设备地址

2. **检查显示屏**
   - 确认显示屏型号
   - 检查供电电压
   - 测试显示屏功能

### 9.6 报警异常

#### 9.6.1 现象描述
- 异常时无报警输出
- 蜂鸣器不响
- ALARM信号异常

#### 9.6.2 排查步骤
1. **检查报警电路**
   - 测量ALARM输出电平
   - 检查蜂鸣器连接
   - 确认报警逻辑

2. **检查软件设置**
   - 确认报警功能已使能
   - 检查异常检测逻辑
   - 验证报警条件

---

## 10. 技术参数

### 10.1 电气参数

| 参数项目 | 技术指标 | 备注 |
|----------|----------|------|
| 工作电压 | DC 24V ±10% | 主电源 |
| 功耗 | ≤15W | 正常工作状态 |
| 继电器控制 | 500ms脉冲，≤50mA | 低电平有效 |
| 状态检测 | 0V/24V，≥10kΩ | 高电平有效 |
| 温度范围 | -10℃~+70℃ | 工作环境 |
| 湿度范围 | ≤85%RH | 无凝露 |

### 10.2 性能参数

| 参数项目 | 技术指标 | 备注 |
|----------|----------|------|
| 响应时间 | ≤500ms | 异常检测响应 |
| 切换时间 | ≤2s | 通道切换完成时间 |
| 温度精度 | ±1℃ | NTC传感器精度 |
| 显示刷新 | 200ms | OLED刷新周期 |
| 串口速率 | 115200bps | 调试接口 |

### 10.3 可靠性参数

| 参数项目 | 技术指标 | 备注 |
|----------|----------|------|
| MTBF | ≥50000小时 | 平均故障间隔时间 |
| 继电器寿命 | ≥10^6次 | 机械寿命 |
| 温度传感器寿命 | ≥5年 | 正常使用条件下 |
| 软件可靠性 | ≥99.9% | 异常检测准确率 |

### 10.4 接口规格

#### 10.4.1 信号接口
- **输入信号**：24V/0V，光耦隔离
- **输出信号**：继电器触点，AC250V/10A
- **反馈信号**：24V/0V，光耦隔离
- **温度接口**：10KΩ NTC，B值3435

#### 10.4.2 通信接口
- **调试串口**：USART3，115200-8-N-1
- **显示接口**：I2C，100kHz
- **扩展接口**：RS485（预留）

### 10.5 机械参数

| 参数项目 | 技术指标 | 备注 |
|----------|----------|------|
| 外形尺寸 | 根据实际设计 | 长×宽×高(mm) |
| 安装方式 | DIN导轨安装 | 35mm标准导轨 |
| 防护等级 | IP20 | 室内使用 |
| 重量 | ≤2kg | 不含外部连线 |

---

## ? 技术支持

### 联系方式
- **技术热线**：请联系设备供应商
- **邮箱支持**：请联系设备供应商  
- **在线支持**：工作日 8:00-18:00

### 文档版本
- **当前版本**：v3.0
- **更新日期**：2025年1月
- **适用软件版本**：Three-channel controller v3.0

### 免责声明
本手册仅适用于指定的硬件和软件版本。使用前请确认版本匹配，不当使用造成的损失由用户自行承担。

---

**? 2025 版权所有 - 三通道高压切换箱控制系统** 